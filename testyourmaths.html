<html>
<head>
	<style>
	.correctAnswer {
		color: green;
	}
	.incorrectAnswer {
		color: red;
	}
	</style>
</head>
<body>
	<h1>Test Yourself</h1>
	<ul>
		<li id="addition">Addition</li>
		<li id="subtraction">Subtraction</li>
		<li id="multiplication">Multiplication</li>
		<li id="division">Division</li>
	</ul>
	<section id="workspace">
	</section>
	<script>
		var options = ["addition", "subtraction", "multiplication", "division"];
		var score, count, streak;
		var number1, number2, currentAnswer;
		var operator;
		function addListener(location, eventType, callFunction, parameters){
			var func = window;
			var parts = callFunction.split('.');
			for (var i = 0; i < parts.length; i++){
				if (func[parts[i]]){
					func = func[parts[i]];
				} else {
					console.error("Trying to attach a listener to a function that does not exist. Cannot find " + callFunction + ".");
					break;
				}
			}
			if (typeof func !== "function"){
				console.error("Trying to attach a listener to something that is not a function (" + callFunction + ").");
			} else {
				if (!parameters){
					document.getElementById(location).addEventListener(eventType, func, true);
				} else {
					document.getElementById(location).addEventListener(eventType, function(){func(parameters);}, true);
				}
			}
		}
		for (var i = 0; i < options.length; i++){
			addListener(options[i], "click", "loadWorkspace", options[i]);
		}
		function loadWorkspace(workspace){
			var htmlCode = "";
			htmlCode += '<p>Total score: <span id="score">0</span> of <span id="count">0</span><br>Streak: <span id="streak">0</span></p>';
			score = 0;
			count = 0;
			streak = 0;
			htmlCode += '<p id="previousQuestion"></p>';
			htmlCode += '<div class="numberBox" id="box1"></div><div class="operator">';
			switch (workspace){
			case "addition":
				operator = '+';
				break;
			case "subtraction":
				operator = '-';
				break;
			case "multiplication":
				operator = '&times;';
				break;
			case "division":
				operator = '&divide;';
				break;
			}
			htmlCode += operator + '</div><div class="numberBox" id="box2"></div><input type="number" id="answer"><button id="checkAnswer">Check Answer</button>';
			document.getElementById("workspace").innerHTML = htmlCode;
			addListener("checkAnswer", "click", "checkAnswer", workspace);
			nextProblem(workspace);
		}
		function nextProblem(workspace){
			function randomNumber(range){
				return Math.floor(Math.random() * range);
			}
			switch (workspace){
			case "addition":
				if (streak < 10){
					number1 = randomNumber(10) + 1;
					number2 = randomNumber(10) + 1;
				} else {
					number1 = randomNumber(streak);
					number2 = randomNumber(streak);
				}
				currentAnswer = number1 + number2;
				break;
			case "subtraction":
				if (streak < 10){
					number2 = randomNumber(10) + 1;
					number1 = randomNumber(10) + number2;
				} else {
					number1 = randomNumber(streak);
					number2 = randomNumber(streak);
				}
				currentAnswer = number1 - number2;
				break;
			case "multiplication":
				if (streak < 10){
					number1 = randomNumber(10) + 1;
					number2 = randomNumber(10) + 1;
				} else {
					number1 = randomNumber(streak);
					number2 = randomNumber(streak);
				}
				currentAnswer = number1 * number2;
				break;
			case "division":
				if (streak < 10){
					currentAnswer = randomNumber(10) + 1;
					number2 = randomNumber(10) + 1;
				} else {
					currentAnswer = randomNumber(streak);
					number2 = randomNumber(streak);
				}
				number1 = currentAnswer * number2;
				break;
			}
			document.getElementById("box1").innerText = number1;
			document.getElementById("box2").innerText = number2;
			userAnswer = document.getElementById("answer").value = null;
		}
		function keyPress(){
			
		}
		function checkAnswer(workspace){
			var userAnswer = document.getElementById("answer").value;
			var previousQuestion = document.getElementById("previousQuestion")
			if (userAnswer){
				var htmlCode = "The previous question was: " + number1 + " " + operator + " " + number2;
				htmlCode += '<br>The correct answer is: ' + currentAnswer;
				htmlCode += '<br>You answered: ' + userAnswer;
				if (parseFloat(userAnswer) === currentAnswer){
					htmlCode += '<br>Great work!';
					score++;
					streak++;
					previousQuestion.className = "correctAnswer";
				} else {
					streak = 0;
					previousQuestion.className = "incorrectAnswer";
				}
				previousQuestion.innerHTML = htmlCode;
				count++;
				document.getElementById("score").innerText = score;
				document.getElementById("count").innerText = count;
				document.getElementById("streak").innerText = streak;
				nextProblem(workspace);
			}
		}
	</script>
</body>
</html>